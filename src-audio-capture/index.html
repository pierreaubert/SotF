<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Capture Demo - Tauri App</title>
    <link rel="stylesheet" href="/src/styles.css" />
</head>
<body>
  <div id="capture_modal" class="modal capture-modal">
    <div class="modal-content capture-modal-content">
      <div class="modal-header">
        <h3>🎤 Audio Capture</h3>
      </div>
      
      <div class="modal-body capture-modal-body">
        <!-- Capture Controls -->
        <div class="capture-controls-block">
          <!-- First row: Device selection and volumes -->
          <div class="capture-controls-row">
            <div class="capture-control-group capture-device-group">
              <div class="device-info-row">
                <label for="input-device">Input:</label>
                <div class="device-info-badges">
                  <span id="input-channels-info" class="channel-count-badge">? ch</span>
                  <span id="input-sample-rate" class="info-badge sample-rate-badge">48kHz</span>
                  <span id="input-bit-depth" class="info-badge bit-depth-badge">24</span>
                  <button id="input-routing-btn" class="routing-button" title="Configure input channel routing">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                      <line x1="0" y1="0" x2="0" y2="16" stroke="currentColor" stroke-width="1"/>
                      <line x1="5.333" y1="0" x2="5.333" y2="16" stroke="currentColor" stroke-width="1"/>
                      <line x1="10.666" y1="0" x2="10.666" y2="16" stroke="currentColor" stroke-width="1"/>
                      <line x1="16" y1="0" x2="16" y2="16" stroke="currentColor" stroke-width="1"/>
                      <line x1="0" y1="0" x2="16" y2="0" stroke="currentColor" stroke-width="1"/>
                      <line x1="0" y1="5.333" x2="16" y2="5.333" stroke="currentColor" stroke-width="1"/>
                      <line x1="0" y1="10.666" x2="16" y2="10.666" stroke="currentColor" stroke-width="1"/>
                      <line x1="0" y1="16" x2="16" y2="16" stroke="currentColor" stroke-width="1"/>
                      <circle cx="2.666" cy="2.666" r="1.5" fill="#57F287"/>
                      <circle cx="8" cy="8" r="1.5" fill="#57F287"/>
                      <circle cx="13.333" cy="13.333" r="1.5" fill="#57F287"/>
                    </svg>
                  </button>
                </div>
              </div>
              <select id="input-device" class="capture-device-select">
                <option value="">Loading devices...</option>
              </select>
            </div>
            
            <div class="capture-control-group capture-volume-group">
              <label for="input-volume">Input Gain:</label>
              <div class="volume-slider-container">
                <input type="range" id="input-volume" class="volume-slider" min="0" max="100" value="70" step="1">
                <div class="volume-value" id="input-volume-value">70%</div>
              </div>
            </div>
            
            <div class="capture-control-group capture-device-group">
              <div class="device-info-row">
                <label for="output-device">Output:</label>
                <div class="device-info-badges">
                  <span id="output-channels-info" class="channel-count-badge">? ch</span>
                  <span id="output-sample-rate" class="info-badge sample-rate-badge">48kHz</span>
                  <span id="output-bit-depth" class="info-badge bit-depth-badge">24</span>
                  <button id="output-routing-btn" class="routing-button" title="Configure output channel routing">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                      <line x1="0" y1="0" x2="0" y2="16" stroke="currentColor" stroke-width="1"/>
                      <line x1="5.333" y1="0" x2="5.333" y2="16" stroke="currentColor" stroke-width="1"/>
                      <line x1="10.666" y1="0" x2="10.666" y2="16" stroke="currentColor" stroke-width="1"/>
                      <line x1="16" y1="0" x2="16" y2="16" stroke="currentColor" stroke-width="1"/>
                      <line x1="0" y1="0" x2="16" y2="0" stroke="currentColor" stroke-width="1"/>
                      <line x1="0" y1="5.333" x2="16" y2="5.333" stroke="currentColor" stroke-width="1"/>
                      <line x1="0" y1="10.666" x2="16" y2="10.666" stroke="currentColor" stroke-width="1"/>
                      <line x1="0" y1="16" x2="16" y2="16" stroke="currentColor" stroke-width="1"/>
                      <circle cx="2.666" cy="2.666" r="1.5" fill="#57F287"/>
                      <circle cx="8" cy="8" r="1.5" fill="#57F287"/>
                      <circle cx="13.333" cy="13.333" r="1.5" fill="#57F287"/>
                    </svg>
                  </button>
                </div>
              </div>
              <select id="output-device" class="output-device-select">
                <option value="">Loading devices...</option>
              </select>
            </div>
            
            <div class="capture-control-group capture-volume-group">
              <label for="output-volume">Output Gain:</label>
              <div class="volume-slider-container">
                <input type="range" id="output-volume" class="volume-slider" min="0" max="100" value="50" step="1">
                <div class="volume-value" id="output-volume-value">50%</div>
              </div>
            </div>
          </div>
          
          <!-- Second row: Signal parameters (slim inline layout) -->
          <div class="capture-controls-row capture-controls-row-slim">
            <div class="capture-control-inline">
              <label for="output-channel">Channel:</label>
              <select id="output-channel" class="output-channel-select">
                <option value="both" selected>Both (Stereo)</option>
                <option value="left">Left Only</option>
                <option value="right">Right Only</option>
              </select>
            </div>
            
            <div class="capture-control-inline">
              <label for="signal-type">Signal:</label>
              <select id="signal-type" class="signal-type-select">
                <option value="sweep" selected>Frequency Sweep</option>
                <option value="white">White Noise</option>
                <option value="pink">Pink Noise</option>
              </select>
            </div>
            
            <div class="capture-control-inline">
              <label for="duration">Duration:</label>
              <select id="duration" class="sweep-duration-select">
                <option value="5">5 seconds</option>
                <option value="10" selected>10 seconds</option>
                <option value="15">15 seconds</option>
                <option value="20">20 seconds</option>
              </select>
            </div>
            
            <div class="capture-control-inline">
              <label for="sample-rate">Sample Rate:</label>
              <select id="sample-rate" class="capture-sample-rate-select">
                <option value="44100">44.1 kHz</option>
                <option value="48000" selected>48 kHz</option>
                <option value="96000">96 kHz</option>
                <option value="192000">192 kHz</option>
              </select>
            </div>
            
            <button id="refresh-devices" class="btn btn-outline btn-sm">🔄 Refresh</button>
          </div>
        </div>
        
        <!-- Graph Display -->
        <div class="capture-graph-container">
          <!-- Graph Controls -->
          <div class="capture-graph-header">
            <div class="capture-graph-controls">
              <label class="capture-phase-toggle">
                <input type="checkbox" id="capture-phase-toggle" checked>
                <span>Show Phase</span>
              </label>
              
              <div class="capture-smoothing-control">
                <label for="capture-smoothing-select">Smoothing:</label>
                <select id="capture-smoothing-select" class="capture-smoothing-select">
                  <option value="1">1/1 octave</option>
                  <option value="3" selected>1/3 octave</option>
                  <option value="6">1/6 octave</option>
                  <option value="12">1/12 octave</option>
                  <option value="24">1/24 octave</option>
                  <option value="48">1/48 octave</option>
                </select>
              </div>
            </div>
          </div>
          
          <canvas id="capture-graph" class="capture-modal-graph"></canvas>
          <div id="capture-graph-placeholder" class="capture-graph-placeholder">
            <div class="capture-placeholder-content">
              <div class="capture-placeholder-icon">📊</div>
              <h4>Frequency Response Graph</h4>
              <p>Click "Start Capture" to begin audio measurement</p>
            </div>
          </div>
          
          <!-- Progress bar -->
          <div id="capture-progress" class="capture-progress hidden">
            <div id="progress-fill" class="capture-progress-fill"></div>
          </div>
          
          <!-- Status message -->
          <div id="status-message" class="capture-status"></div>
        </div>
        
        <!-- Results Info -->
        <div id="results-container" class="results-info-container hidden">
          <div id="results-info"></div>
        </div>
      </div>
      
      <div class="modal-footer">
        <div class="capture-bottom-controls">
          <div class="capture-bottom-left">
            <!-- Empty for now, can add phase/smoothing controls later -->
          </div>
          <div class="capture-bottom-right">
            <button id="recall-sweeps" class="btn btn-outline capture-recall-btn">📂 Recall Sweeps</button>
            <button id="start-capture" class="btn btn-primary capture-start-btn">🎤 Start Capture</button>
            <button id="stop-capture" class="btn btn-danger capture-stop-btn hidden" disabled>⏹️ Stop</button>
            <button id="export-csv" class="btn btn-secondary capture-export-btn hidden" disabled>💾 Export CSV</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recall Sweeps Modal -->
  <div id="recall-modal" class="modal recall-modal hidden">
    <div class="modal-content recall-modal-content">
      <div class="modal-header">
        <h3>📂 Recall Saved Sweeps</h3>
        <button id="recall-modal-close" class="modal-close-btn">&times;</button>
      </div>
      
      <div class="modal-body recall-modal-body">
        <div class="recall-controls">
          <div class="recall-stats">
            <span id="sweep-count">0 sweeps saved</span>
          </div>
          <button id="clear-all-sweeps" class="btn btn-danger btn-sm">🗑️ Clear All</button>
        </div>
        
        <div id="sweeps-list" class="sweeps-list">
          <div class="sweeps-empty">
            <p>No saved sweeps yet. Capture a sweep to save it automatically.</p>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="recall-modal-cancel" class="btn btn-outline">Cancel</button>
      </div>
    </div>
  </div>

   <!-- Vite will inject the script here -->
   <script type="module" src="/src/main.ts"></script>
 </body>
 </html>
